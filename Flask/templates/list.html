<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Please enter your data</h1>
    
    <p id="first"><p id="fielddump" class="ffield"><input type="temptext" class="x1x1" onblur="con()" value="Vorname"><input type="temptext" class="x1x2" onblur="con()" value="Nachname"><input type="temptext" class="x1x3" onblur="con()" value="Mail-Addresse"><input type="temptext" class="x1x4" onblur="con()" value="Addresse"></p><p id = "secfielddump" class="secfield"><p id="field" class="field"></p><p id = "secfield" class="secfield"></p></p></p>
    <script>
        let rowcount = 1
        let columncount = 4
        function addrow(){
            rowcount++
            console.log('rowcount is '+rowcount)
            content = ''
            for(let i = 1;i<columncount+1;i++){
                let unid = 'x' + rowcount + "x" + i
                let inp = '<input type="temptext" class="' + unid + '" onblur="con()">'
                content = content + inp
            }
            console.log(content)
            document.getElementById("field").innerHTML=content
            document.getElementById("field").classList = "ffield"
            document.getElementById("field").id = "fielddump"
            document.getElementById("secfield").innerHTML='<p id="field" class="field"></p><p id = "tempfield" class ="secfield"></p>'
            document.getElementById("secfield").id = "secfielddump"
            document.getElementById("tempfield").id = "secfield"
            console.log
        }
        function addcol(){
            columncount++
            content = ''
            for(let i = 1;i<columncount+1;i++){
                let unid = 'x' + rowcount + "x" + i
                let inp = '<input type="temptext" class="' + unid + '" onblur="con()">'
                content = content + inp
            }
            console.log(content)
            curdoc = document.querySelectorAll(".ffield")
            console.log(curdoc)
            for(let i=0;i<curdoc.length;i++){
                curdoc[i].innerHTML=content
            }
        }
        function delrow(){
            console.log('rowcount is '+rowcount)
            if(rowcount > 1){
                curdoc = document.querySelectorAll(".secfield")
                if(curdoc.length > 2){
                    curcurdoc = curdoc[curdoc.length-2]
                }
                else{
                    curcurdoc = curdoc[0]
                }
                curdocval = document.querySelectorAll(".ffield")
                curcurdocval = curdocval[curdocval.length-1]
                console.log(curdocval +'is curdocval')
                curcurdocval.innerHTML = ""
                curcurdocvalnew = curdocval[curdocval.length-2]
                curcurdocvalnew.id="field"

                console.log(curdoc)
                console.log(curcurdoc)
                curcurdoc.innerHTML = ""
                curcurdocnew = curdoc[curdoc.length-3]
                curcurdocnew.id = "secfield"

                rowcount--
                rowcount--
                addrow()
            }
        }
        function delcol(){
            if(columncount>1){
            columncount--
            content = ''
            for(let i = 1;i<columncount+1;i++){
                unid = 'x' + rowcount + "x" + i
                inp = '<input type="temptext" class="' + unid + '" onblur="con()">'
                content = content + inp
            }
            console.log(content)
            curdoc = document.querySelectorAll(".ffield")
            console.log(curdoc)
            for(let i=0;i<curdoc.length;i++){
                curdoc[i].innerHTML=content
            }}
        }
        function giveall(){
            for(let i=0;i<document.querySelectorAll(".ffield").length;i++){
                console.log(document.querySelectorAll(".ffield")[i])
            }
            console.log("This was ffield")
            for(let i=0;i<document.querySelectorAll(".field").length;i++){
                console.log(document.querySelectorAll(".field")[i])
            }
            console.log("This was field")
            for(let i=0;i<document.querySelectorAll(".secfield").length;i++){
                console.log(document.querySelectorAll(".secfield")[i])
            }
            console.log("This was secfield")
        }
    </script>
    <button onclick="addrow()">Add Row</button>
    <button onclick="addcol()">Add Column</button>
    <button onclick="delrow()">Delete Row</button>
    <button onclick="delcol()">Delete Column</button>
    <button onclick="giveall()">Gve all</button>
    <script>
        function deconstruct(id) {
            out = id.toString().charAt(1)
            console.log(id + " is id");
            return out
        }
        function createrealalldata() {
            return ''
            //This function creates a list[list[]] structure that has the column names as its first sublist
        }
        function send() {
            let variable = createrealalldata();
            var xhr = new XMLHttpRequest();
            var url = "http://127.0.0.1:5000/login";
            var method = 'POST';

            xhr.open(method, url);
            xhr.setRequestHeader('Access-Control-Allow-Origin', '*')
            xhr.setRequestHeader('Content-Type', 'application/json')
            //xhr.onload = function () {};

            var data = new FormData();
            data.append('user', 'person');
            data.append('pwd', 'password');

            let realdata = JSON.stringify(variable)

            xhr.send(realdata);
        }
        function con(){
            dataArray = []
            for(let i=1;i<rowcount+1;i++){
                datarow = []
                for(let ii=1;ii<columncount+1;ii++){
                    id = "x" + i + "x" + ii
                    currow = document.querySelectorAll("." + id)
                    datarow.push(currow[0].value)
                }
                dataArray.push(datarow)
            }
            console.log(dataArray)
            //Send the data and replace send()
            //Make a backup array that can be put back in after a column has been deleted
        }
    </script>

    <button><a href="http://127.0.0.1:5000/myfile.txt" download="">Export this table</a></button>

    <p>Todo:</p>
    <p>Fix Row / Column Min / Max (ar - dr - ar - dr)</p>
    <p>Fix Row / Column deletion in lower counts</p>
    <p>Reimplement export</p>
    <p>Implement login</p>
    <p>Implement database</p>
    <p>Write Log File</p>
    <p>Do a write check at start</p>

</body>

</html>

<!-- 

-->